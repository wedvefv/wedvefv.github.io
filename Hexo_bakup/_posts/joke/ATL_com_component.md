---
layout: post
title: ATL编写com组件
category: C++
date: 2016-10-5 20:04:30
tags: c++
comments: true

---

# ATL编写com组件
1 打开vc6 ,建立ALT工程，这个工程就是一个com组件（一般是dll形式），也可以是exe形式的二进制。这个组件可以
有多个com对象，一个对象又可以有多个接口。

3.工具栏insert 插入new ATL object对象 ,选择simple object 选项，输入mycom
就建立了一个com对象， 在左边classviewer 里面Imycom接口右键，添加method，给接口添加函数。
再实现函数，编译，就完成了一个dll的创建。

# 了解一些C++类的概念：
虚函数： 函数前面有virtual 修饰，可以有实现，非类成员不能是虚函数，静态成员不能是虚函数，构造函数也不能使虚的。
（虚函数是通过对象的虚函数表的指针vtbl访问的，但是构造函数是用来构造对象时自动调用的，都没还没对象，
怎么用vtbl指针成员访问构造函数，所以，构造函数不能是虚函数），优秀的程序员一般把父类析构函数设置为虚函数，若不这样做，删除派生类对象时，父类指针只会调用父类的（非虚）析构函数，不会调用派生类的析构函数，就内存泄漏了。所以设置为虚函数。
純虚函数： virtual void PrintTyre()=0;这么定义的，没有具体实现。
抽象类： 不能用来产生对象的类，只能当作基类，并且里面至少包含一个纯虚函数。

抽象类的构造函数： 既然不能实例化对象，构造函数就没用，一般不写。系统默认有一个protected类型的，
给派生类构造时调用的。

派生类：实例化函数调用顺序是： 基类构造函数-->派生类构造 ，delete顺序是：子类析构函数-->基类析构函数。

# c++多态
方式1： 静态（编译时）多态，是函数重载和运算符重载。
方式2: 动态（运行时）多态，是通过虚函数和继承。
运行时多态，编译器为了实现c++虚函数，为每个类的虚函数分配一个虚函数表，同时添加一个vtbl指针成员，指向这个表。这样父类指针可以指向派生类。根据实际指向的派生类，调用派生类重写的父类虚函数。实现父类指针的多态。

# c++的接口
接口是通过c++的纯虚基类实现的，里面只有纯虚函数。构造和析构函数不要声明。
一个C++类可以实现多个接口
# 什么是接口呢？
```c
接口可以用c++的类模拟
interface A{
    virtual void function1() =0;  //全部是纯虚函数，由于构造函数用于产生虚函数表
    virtual void function2() =0;
    virtual void function3() =0;
} 
interface B{
    virtual void function4() =0;  //全部是纯虚函数，由于构造函数用于产生虚函数表
    virtual void function5() =0;
    virtual void function6() =0;
} 

实现
```
