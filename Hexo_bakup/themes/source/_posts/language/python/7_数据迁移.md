---
layout: post
title: flask 第7章（数据迁移模块）
category: flask
date: 2019-02-13 11:41:00

---


##  安装模块

```py
	pip install flask-migrate
```

## 配置模块

```py
	# 导入模块类
	from flask_migrate import Migrate,MigrateCommand
	# ...
	migrate = Migrate(app,db)
	manger.add_command('db', MigrateCommand)
```


## 执行顺序

### 1. 初始化迁移仓库
```py
python hello.py db init
# 会创建migrations 文件夹
```

### 2. 创建迁移脚本模板
```py
python hello.py db migrate -m "migrate initial"
# version文件夹会生成一个py文件里面有2个函数，升级数据库函数upgrade，降级数据库函数downgrade，需要用户自己重写所需操作

```

### 3. 升级更新数据库
```py
python hello.py db upgrade 
# 执行该命令会自动执行version目录下的py脚本中的upgrade函数，前提是数据库alembic_version表中没有该版本的升级记录。

# 对于第一个迁移，和db.create_all()方法一样，后续版本升级，upgrade命令会把改动应用到数据库中。
```
