---
layout: post
title: redis文章投票
category: redis 
date: 2019-02-22 15:50:00
---


## 1. 文章信息可以用hash表示

- 比如文章id为key，文章属性为filed，属性值为value
```js
	key : articel:1 
	title : 这是标题
	link： www.baidu.com
	updatetime: 2019-02-21 00:00:00
	
```
- 也可以用大的hash，每个filed是一个文章id，value是一个json表示文章属性，



## 2. 文章id和发布时间对应关系用zset表示

- 文章id对应member，发布时间是score

## 3. 文章id和文章评分对应关系也可用zset表示

- 文章id对应member， 分数对应score


## 4. 对一篇文章首次投票之后，发生什么变化？
- 0. 有时只需要7天之内发布的文章才可以投票，否则直接返回。
- 1. 用户是不支持重复投票的，所有应该有一个文章id对应的set类型的key，将投过票的uid加入到里面，如果加入失败，就说明重复了，就不增加评分。
- 2. 首先对应文章id的评分增加，具体增加规则： 将文章的已获得的支持票数*一个常量 +发布时间戳；常量可以432（86400/200）200个投票需求，平均一天时间。，这只是我见到的一个方法。
- 3. 增加文章的投票+1，使用hincrby ，前提是如果用hash记录文章属性的话，投票数就是一个属性。
- 4. 考虑到并发，如果以上三个操作应该用事物操作，保证原子性。






