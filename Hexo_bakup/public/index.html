
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9224870466612638",
    enable_page_level_ads: true
  });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133291163-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133291163-1');
</script>


  <meta charset="UTF-8">
  
    <title>时光</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wedvefv">
    

    
    <meta name="description" content="愿你出走半生，归来仍是少年！">
<meta property="og:type" content="website">
<meta property="og:title" content="时光">
<meta property="og:url" content="http://wedvefv.github.io/index.html">
<meta property="og:site_name" content="时光">
<meta property="og:description" content="愿你出走半生，归来仍是少年！">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="时光">
<meta name="twitter:description" content="愿你出走半生，归来仍是少年！">

    
    <link rel="alternative" href="/atom.xml" title="时光" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="时光" title="时光"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="时光">时光</a></h1>
				<h2 class="blog-motto">记录时光</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:wedvefv.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/06/09/ngx_lua/cookie_and_session/" title="一张导图了解cookie和session" itemprop="url">一张导图了解cookie和session</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-06-09T13:50:00.000Z" itemprop="datePublished"> Published 2019-06-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="cookie和session的区别"><a href="#cookie和session的区别" class="headerlink" title="cookie和session的区别"></a>cookie和session的区别</h1><p><img src="/2019/06/09/ngx_lua/cookie_and_session/cookie_and_session.png" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/nginx/">nginx</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/06/09/linux/centos6和7的启动流程/" title="一张图看懂centos6和7的启动流程区别" itemprop="url">一张图看懂centos6和7的启动流程区别</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-06-09T02:34:58.000Z" itemprop="datePublished"> Published 2019-06-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h1><p><img src="/2019/06/09/linux/centos6和7的启动流程/centos6和7的启动流程.png" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/hexo/">hexo</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/06/08/linux/一文了解linux开机启动/" title="如何在centos7中添加开机启动项" itemprop="url">如何在centos7中添加开机启动项</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-06-08T02:34:58.000Z" itemprop="datePublished"> Published 2019-06-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="1-linux的启动等级"><a href="#1-linux的启动等级" class="headerlink" title="1. linux的启动等级"></a>1. linux的启动等级</h4><p>0 关机模式<br>1 单用户模式<br>2 无网络多用户模式<br>3 有网络多用户模式，如果没网络和2一样。<br>4.系统保留，未使用<br>5.GUI图形界面<br>6.重启模式，默认不能是这个级别，否则就会无限循环重启</p>
<ul>
<li><em>正常默认就是3了, 命令行模式，有桌面的，应该默认是5.</em></li>
<li><em>关机就可以终端输入init 0，重启就init 6</em></li>
</ul>
<p>7.默认级别在centos7之前是/etc/inittab文件设置的，之后就由systemctl接管了</p>
<ul>
<li>查看默认运行级别的方式为:<blockquote>
<p>systemctl get-default</p>
</blockquote>
</li>
<li>设置默认运行级别的方式:<blockquote>
<p>systemctl set-default TARGET.target</p>
</blockquote>
</li>
</ul>
<p><em>级别分别对应如下: </em></p>
<ul>
<li><blockquote>
<p>shutdown.target</p>
</blockquote>
</li>
<li><blockquote>
<p>emergency.target</p>
</blockquote>
</li>
<li><blockquote>
<p>rescure.target</p>
</blockquote>
</li>
<li><blockquote>
<p>multi-user.target</p>
</blockquote>
</li>
<li><blockquote>
<p>无</p>
</blockquote>
</li>
<li><blockquote>
<p>graphical.target</p>
</blockquote>
</li>
<li><blockquote>
<p>无</p>
</blockquote>
</li>
</ul>
<h4 id="2-每个等级，系统初始化运行了哪些脚本呢"><a href="#2-每个等级，系统初始化运行了哪些脚本呢" class="headerlink" title="2. 每个等级，系统初始化运行了哪些脚本呢"></a>2. 每个等级，系统初始化运行了哪些脚本呢</h4><ul>
<li>/etc/init.d/ 目录是个软连接 实际是/etc/rc.d/init.d</li>
<li>/etc/rc1.d/</li>
<li>/etc/rc2.d/</li>
<li>/etc/rc3.d/</li>
<li>/etc/rc4.d/</li>
<li>/etc/rc5.d/</li>
<li>/etc/rc6.d/ 以上6个目录也都是软连接，实际是/etc/rc.d/目录下的</li>
</ul>
<ul>
<li><em>最终就是/etc/rc.d/init.d/ 和/etc/rc.d/rcX.d/目录了</em></li>
<li><em>但是rcX.d/目录下的文件实质也是软连接，指向/etc/rc.d/init.d/目录下的脚本</em></li>
</ul>
<h4 id="3-添加开机启动项-chkconfig"><a href="#3-添加开机启动项-chkconfig" class="headerlink" title="3. 添加开机启动项(chkconfig)"></a>3. 添加开机启动项(chkconfig)</h4><ul>
<li>经过之前的分析，实际上就是/etc/rc.d/init.d 目录下的东东，分析发现 都是shell脚本</li>
<li>脚本 按自己的操作写就ok</li>
<li>比如你写一个nginx自启动的脚本/etc/rc.d/init.d/nginx</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>chkconfig: 2345 80 90</span><br><span class="line"><span class="meta">#</span>description:auto_run</span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">if [ "$1" == "start" ]; then</span><br><span class="line">    /usr/local/openresty/nginx/sbin/nginx</span><br><span class="line">    exit  0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ "$1" == "stop" ]; then</span><br><span class="line">    /usr/local/openresty/nginx/sbin/nginx -s stop</span><br><span class="line">    exit  0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [[ $1 == 'reload' ]]; then</span><br><span class="line">    /usr/local/openresty/nginx/sbin/nginx -s reload</span><br><span class="line">    exit  0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo "sh nginx start|stop|reload"</span><br></pre></td></tr></table></figure>
<ul>
<li>chmod +x nginx</li>
<li>chkconfig –add nginx (老写法：chkconfig nginx on)</li>
<li><strong>这样在对应等级rcX.d/目录下就会生成对应的链接，K开头脚本这个服务关闭，S开头的脚本是这个服务要开启.</strong></li>
<li>每个添加的自启动脚本必须要有2行注释：</li>
<li><blockquote>
<p>#chkconfig: 2345 80 90</p>
</blockquote>
</li>
<li><blockquote>
<p>#description:nginx_test 可以随便写描述</p>
</blockquote>
</li>
<li><p>centos7 开头这么加也可以</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>## BEGIN INIT INFO</span><br><span class="line"><span class="meta">#</span> Provides:          php-fpm</span><br><span class="line"><span class="meta">#</span> Required-Start:    $remote_fs $network</span><br><span class="line"><span class="meta">#</span> Required-Stop:     $remote_fs $network</span><br><span class="line"><span class="meta">#</span> Default-Start:     2 3 4 5</span><br><span class="line"><span class="meta">#</span> Default-Stop:      0 1 6</span><br><span class="line"><span class="meta">#</span> Short-Description: starts php-fpm</span><br><span class="line"><span class="meta">#</span> Description:       starts the PHP FastCGI Process Manager daemon</span><br><span class="line"><span class="meta">#</span>## END INIT INFO</span><br></pre></td></tr></table></figure>
</li>
<li><p>解释下: 2345表示四个启动等级可以需要运行nginx服务; 在rc2|3|4|5.d目录下生成S<strong>80</strong>nginx脚本，rc0|6.d目录下生成K<strong>90</strong>nginx脚本都指向/etc/rc.d/init.d/nginx脚本（80，90为了标识脚本含义是开启还是关闭，虽然脚本内容一样，但是<strong>K开头执行时加参数 stop，S开头的执行时加参数 start</strong>）</p>
</li>
</ul>
<h4 id="4-在rc-local文件中添加启动项"><a href="#4-在rc-local文件中添加启动项" class="headerlink" title="4. 在rc.local文件中添加启动项"></a>4. 在rc.local文件中添加启动项</h4><ul>
<li><p>/etc/rc.d/init.d/rc.local 这个是init.d–&gt; rc.d 执行或之后执行的脚本，通常是用户自己定义的一些开机启动任务.</p>
</li>
<li><p><strong>下次总结一下Centos6的启动顺序</strong></p>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/hexo/">hexo</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/02/language/python/3_reload_sys/" title="python 编码reload(sys)的作用" itemprop="url">python 编码reload(sys)的作用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-05-02T06:00:00.000Z" itemprop="datePublished"> Published 2019-05-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="为什么需要sys-setdefaultencoding-“utf-8”"><a href="#为什么需要sys-setdefaultencoding-“utf-8”" class="headerlink" title="为什么需要sys.setdefaultencoding(“utf-8”)"></a>为什么需要sys.setdefaultencoding(“utf-8”)</h2><ul>
<li>因为python转码是通过unicode作为中间码的。</li>
<li>比如字符串 x = “你们”，本身是str，<br>首先我们指定了文件编码uft8，所以x是utf8编码的。</li>
<li>如果要转化gb18030， 默认是x用默认解码方式（ASCII）decode成中间码 unicode -&gt;   encode成gb18030</li>
<li>如果x是abc这些ascii字符本身ascii和utf8方式是一样的,不会报错;</li>
<li>但是x是中文，就不能按ascii方式解码了。。怎么办呢？</li>
<li><p>1 . 自己指定解码方式，在编码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = x.decode(<span class="string">"utf-8"</span>).encode(<span class="string">"gb18030"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.开头设置默认编解码方式</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="为什么reload-sys-呢"><a href="#为什么reload-sys-呢" class="headerlink" title="为什么reload(sys)呢"></a>为什么reload(sys)呢</h2><ul>
<li>因为模块/lib/site.py删除了sys.setdefaultencoding这个函数。</li>
</ul>
<h2 id="site-py-有什么作用"><a href="#site-py-有什么作用" class="headerlink" title="site.py 有什么作用"></a>site.py 有什么作用</h2><ul>
<li>是解释器初始化时自动导入的，这个模块的作用是：自动将第三方模块路径加入到sys.path中。</li>
</ul>
<h2 id="import的实质"><a href="#import的实质" class="headerlink" title="import的实质"></a>import的实质</h2><ul>
<li>import sys导入语句，只是导入了一个对sys的引用，因为别人已经提前导入了sys，后面的模块使用sys都是引用这个对象。</li>
<li>而作为初始化模块site.py,导入了许多内建模块包括sys，而且删除了sys.setdefaultencoding这个方法，后面你写的模块，只要导入sys,都是没有这个方法的。</li>
<li>所以需要reload一把，reload也是有前提的，就是之前已经加载过的模块，如果没有加载过的，就无重谈起重新加载了。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/python/">python</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/04/13/language/html/weixin/" title="微信支付流程" itemprop="url">微信支付流程</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-04-13T01:40:00.000Z" itemprop="datePublished"> Published 2019-04-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="三个平台都有什么？"><a href="#三个平台都有什么？" class="headerlink" title="三个平台都有什么？"></a>三个平台都有什么？</h2><ul>
<li>微信公众平台: 微信官方平台，功能： 群发推送、自动回复、二维码订阅，用途：消息推送、品牌传播、分享</li>
<li>微信开放平台: 为第三方提供接口，比如分享朋友圈，发送给微信好友等</li>
<li>微信商户平台：主要是用于微信支付的，比如APP和公众号需要接入支付功能，就需要申请一个商户号。</li>
</ul>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><ul>
<li>在开放平台，注册自己的app，通俗讲就是在微信备案一下。</li>
</ul>
<h2 id="客户端需要干嘛？"><a href="#客户端需要干嘛？" class="headerlink" title="客户端需要干嘛？"></a>客户端需要干嘛？</h2><ul>
<li>需要下载微信安卓或者ios版SDK,集成到自己的app中，主要是为了调起微信支付模块。</li>
<li>app调起支付模块，需要传参数吧，不然请求微信服务器也不知道具体转给谁钱，转多少钱…</li>
<li>支付参数哪里来呢？服务器生成啊…..</li>
<li>支付完成后微信会返回微信订单号的信心，后期可以用于到微信服务器查询订单状态。</li>
</ul>
<h2 id="商户服务器需要干嘛，比如一个卖游戏点卡的app？"><a href="#商户服务器需要干嘛，比如一个卖游戏点卡的app？" class="headerlink" title="商户服务器需要干嘛，比如一个卖游戏点卡的app？"></a>商户服务器需要干嘛，比如一个卖游戏点卡的app？</h2><h3 id="给客户端提供接口"><a href="#给客户端提供接口" class="headerlink" title="给客户端提供接口"></a>给客户端提供接口</h3><ul>
<li>1.支付接口，这个接口需要以下业务功能</li>
<li><blockquote>
<p>1.去查询用户是否存在，用户信息可以在redis中记录</p>
</blockquote>
</li>
<li><blockquote>
<p>2.如果某类商品，用户只能有一个产品生效的,比如点卡A,产品类别id为A</p>
</blockquote>
</li>
<li><blockquote>
<p>3.使用redis记录uid:goodsid[A]:hash记录这个购买的点卡x的信息,记录createtime，orderid，prepayid</p>
</blockquote>
</li>
<li><blockquote>
<p>4.如果uid对应点卡A的信息存在，且now - createtime &lt; 15分钟，说明微信没回调过来，是支付中…的状态。直接拿缓存中信息返回给客户端就可以了，供客户端调用支付模块。</p>
</blockquote>
</li>
<li><blockquote>
<p>5.如果uid对应的点卡信心不存在，就说明用户没买过这种A这类的商品,生成28位的订单号作为out_trade_no参数，其他参数按规定设置，然后调用微信统一下单接口 <a href="https://api.mch.weixin.qq.com/pay/unifiedorder" target="_blank" rel="noopener">https://api.mch.weixin.qq.com/pay/unifiedorder</a></p>
</blockquote>
</li>
<li><blockquote>
<ol start="6">
<li>当前商户服务器统一下单的过程中，需要用mysql记录自己的订单信息、更新用户的余额扣减、记录一些用户订购该类产品的缓存信息等；mysql数据用于支付完成后，微信发起异步回调状态时更新订单状态。</li>
</ol>
</blockquote>
</li>
<li><blockquote>
<p>7.下单后生成预支付id：prepayid，因为还没有真正调起支付模块，只是微信那边现生成一个预支付回话id。</p>
</blockquote>
</li>
<li><blockquote>
<p>8.有了prepayid加上其他参数，返回给客户端用于真正调起sdk支付模块。</p>
</blockquote>
</li>
<li><blockquote>
<p>9.调完支付模块后，微信服务器会立刻返回到app中，这时候客户端需要实现onResp回调函数，如果支付成功，需要去服务器查询是否真的ok，永远以服务端返回的支付结果为准。</p>
</blockquote>
</li>
<li><p>2.主动查询订单接口</p>
</li>
<li><blockquote>
<p>1.需要知道我们自己分配的订单orderid，和uid，从mysql获取缓存，校验orderid和uid是不是对应同一个人。</p>
</blockquote>
</li>
<li><blockquote>
<p>2.查到mysql记录的这个订单状态还是支付中，就用orderid，微信推荐优先使用微信订单号，如果这个字段缺少就用商户的订单号。</p>
</blockquote>
</li>
<li><blockquote>
<p>3.调起微信查询url <a href="https://api.mch.weixin.qq.com/pay/orderquery，判断返回结果，然后事务操作（更新mysql订单状态，及用户金钱信息余额等）。" target="_blank" rel="noopener">https://api.mch.weixin.qq.com/pay/orderquery，判断返回结果，然后事务操作（更新mysql订单状态，及用户金钱信息余额等）。</a></p>
</blockquote>
</li>
</ul>
<ul>
<li>回调接口（给微信服务器使用，用于回调支付状态）</li>
<li><blockquote>
<p>1.我们首先查询订单状态是否为1支付中的状态，如果不是，说明失败，或者成功了，不与理会</p>
</blockquote>
</li>
<li><blockquote>
<p>2.如果数据return_code或者result_code不全是SUCCESS，直接按对应格式返回成功</p>
</blockquote>
</li>
<li><blockquote>
<p>3.如果都是SUCCESS，校验WXPAY_SECKEY，APPID，MCHID。</p>
</blockquote>
</li>
<li><blockquote>
<p>4.都通过了,则事务操作（更新mysql订单状态，及用户金钱信息余额等）,修改必要的缓存。</p>
</blockquote>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/微信支付/">微信支付</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/03/02/linux/AES_RSA_DSA/" title="简单总结一下加密算法AES-DES-RAS-DSA-ECDSA-ECC" itemprop="url">简单总结一下加密算法AES-DES-RAS-DSA-ECDSA-ECC</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-03-02T04:00:00.000Z" itemprop="datePublished"> Published 2019-03-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="加密体系"><a href="#加密体系" class="headerlink" title="加密体系"></a>加密体系</h2><h3 id="对称加密算法，加密和机密密钥一样，加密方和解密方都持有"><a href="#对称加密算法，加密和机密密钥一样，加密方和解密方都持有" class="headerlink" title="对称加密算法，加密和机密密钥一样，加密方和解密方都持有."></a>对称加密算法，加密和机密密钥一样，加密方和解密方都持有.</h3><ul>
<li><p>DES加密 56位密钥长度，美国数据加密标准，DES算法的入口参数有三个：Key、Data、Mode。其中Key为7个字节共56位，是DES算法的工作密钥；Data为8个字节64位，是要被加密或被解密的数据；Mode为DES的工作方式,有两种:加密或解密。 </p>
</li>
<li><p>AES加密 高级加密标准，一种区块加密算法,为了取代DES。</p>
</li>
<li>二者的优点是加密快，资源消耗少，但是AES比DES安全。</li>
</ul>
<h3 id="非对称加密算法"><a href="#非对称加密算法" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h3><ul>
<li>RSA，基于数学原理，一个极大数做质数(也叫素数)分解很困难;简单讲,就是你根据公钥很难计算出私钥，因为解密需要接受者的私钥。rsa 由于密钥长度大，加密慢，所以一般只加密产生的会话密钥，会话秘钥才用于加密来加密数据。</li>
<li><p>DSA(DSS), 签名算法， DSA是基于整数有限域离散对数难题的，其安全性与RSA相比差不多。DSA的一个重要特点是两个素数公开，这样，当使用别人的p和q时，即使不知道私钥，你也能确认它们是否是随机产生的，还是作了手脚。RSA算法却做不到</p>
</li>
<li><p>ECC 椭圆加密算法， 其数学基础是利用椭圆曲线上的有理点构成Abel加法群上椭圆离散对数的计算困难性，主要优势是比其他方式如RSA使用更短的密钥长度，达到同等安全级别，优点就是别rsa，dsa快，存储空间小，贷款要求低。</p>
<blockquote>
<p>演变而来的ECDSA（ECC+DSA）数字签名算法，是ECC对DSA的一种模拟实现，ECC是椭圆的离散对数问题，DSA也是对数问题。只不过使用签名采用ECC算法，输出也是2个值，r和s</p>
</blockquote>
</li>
</ul>
<h2 id="其他算法"><a href="#其他算法" class="headerlink" title="其他算法"></a>其他算法</h2><ul>
<li>md5: 消息摘要算法，防止数据被篡改。</li>
<li>sha系列，安全散列算法，也是散列函数，应用于信息安全和数字签名领域，都是不需要解密的，也无法解密。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/加密算法/">加密算法</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/03/02/linux/git_tag用法/" title="git_tag用法" itemprop="url">git_tag用法</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-03-02T04:00:00.000Z" itemprop="datePublished"> Published 2019-03-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tag-和branch的区别"><a href="#tag-和branch的区别" class="headerlink" title="tag 和branch的区别"></a>tag 和branch的区别</h2><ul>
<li>Git tag是一系列commit的中的一个点，只能查看，不能移动。</li>
<li>branch是一系列串联的commit的线。</li>
</ul>
<h3 id="git-tag的用法"><a href="#git-tag的用法" class="headerlink" title="git tag的用法"></a>git tag的用法</h3><ul>
<li>我们常常在代码封板时,使用git 创建一个tag ,这样一个不可修改的历史代码版本就像被我们封存起来一样,不论是运维发布拉取,或者以后的代码版本管理,都是十分方便的</li>
</ul>
<h3 id="git的tag功能"><a href="#git的tag功能" class="headerlink" title="git的tag功能"></a>git的tag功能</h3><ul>
<li>git 下打标签其实有2种情况<br>轻量级的：它其实是一个独立的分支,或者说是一个不可变的分支.指向特定提交对象的引用</li>
<li>带附注的：实际上是存储在仓库中的一个独立对象，它有自身的校验和信息，包含着标签的名字，标签说明，标签本身也允许使用 GNU Privacy Guard (GPG) 来签署或验证,电子邮件地址和日期，一般我们都建议使用含附注型的标签，以便保留相关信息<br>所以我们推荐使用第二种标签形式</li>
</ul>
<h3 id="创建tag"><a href="#创建tag" class="headerlink" title="创建tag"></a>创建tag</h3><ul>
<li>git tag -a V1.2 -m ‘release 1.2’</li>
<li>上面的命令我们成功创建了本地一个版本 V1.2 ,并且添加了附注信息 ‘release 1.2’</li>
</ul>
<h2 id="查看tag"><a href="#查看tag" class="headerlink" title="查看tag"></a>查看tag</h2><ul>
<li>git tag</li>
<li>要显示附注信息,我们需要用 show 指令来查看</li>
<li><p>git show V1.2</p>
</li>
<li><p>但是目前这个标签仅仅是提交到了本地git仓库.如何同步到远程代码库</p>
</li>
<li><p>git push origin –tags</p>
</li>
<li><p>如果刚刚同步上去,你缺发现一个致命bug ,需要重新打版本,现在还为时不晚.</p>
</li>
<li><p>git tag -d V1.2</p>
</li>
<li><p>到这一步我们只是删除了本地 V1.2的版本,可是线上V1.2的版本还是存在,如何办?这时我们可以推送的空的同名版本到线下,达到删除线上版本的目标:</p>
</li>
<li><p>git push origin :refs/tags/V1.2</p>
</li>
<li><p>如何获取远程版本?</p>
</li>
<li>git fetch origin tag V1.2</li>
<li>这样我们可以精准拉取指定的某一个版本.适用于运维同学部署指定版本.</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/git/">git</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/03/02/linux/git_linux搭建服务器/" title="git_linux搭建服务器" itemprop="url">git_linux搭建服务器</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-03-02T04:00:00.000Z" itemprop="datePublished"> Published 2019-03-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="为什么本地搭建一个git服务器"><a href="#为什么本地搭建一个git服务器" class="headerlink" title="为什么本地搭建一个git服务器"></a>为什么本地搭建一个git服务器</h2><ul>
<li>对于自己学习使用的代码，在没有网络的情况下不能用github，gitlab,所以本地建立一个git服务器。</li>
</ul>
<h2 id="git服务器环境准备centos7"><a href="#git服务器环境准备centos7" class="headerlink" title="git服务器环境准备centos7"></a>git服务器环境准备centos7</h2><h2 id="服务端创建git用户"><a href="#服务端创建git用户" class="headerlink" title="服务端创建git用户"></a>服务端创建git用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id git # 查看是否存在git用户，存在就不创建了。</span><br><span class="line">useradd git</span><br><span class="line">passwd git</span><br><span class="line">输入密码，我设置的是xxx@123</span><br></pre></td></tr></table></figure>
<h2 id="客户端开启公钥认证认证，免密push-pull"><a href="#客户端开启公钥认证认证，免密push-pull" class="headerlink" title="客户端开启公钥认证认证，免密push/pull"></a>客户端开启公钥认证认证，免密push/pull</h2><ul>
<li><p>首先服务端需要开启ssh服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">RSAAuthentication yes </span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br><span class="line">如果是centos7.4以上（含7.4），ssh1已经不支持了，只支持ssh2代协议。所以RSAAuthentication项是没有的</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端执行 执行ssh-keygen -t rsa 生成公钥和私钥</p>
</li>
<li>复制客户端公钥到服务器端ssh-copy-id -i ~/.ssh/id_rsa.pub <a href="mailto:git@192.168.61.128" target="_blank" rel="noopener">git@192.168.61.128</a> </li>
</ul>
<h2 id="服务端创建git仓库"><a href="#服务端创建git仓库" class="headerlink" title="服务端创建git仓库"></a>服务端创建git仓库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/git/gittest.git</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 初始化这个仓库</span><br><span class="line">cd /data/git/gittest.git</span><br><span class="line">git init --bare .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 目录所属用户设置</span><br><span class="line">chown -R git:git /data/git</span><br></pre></td></tr></table></figure>
<h2 id="客户端clone远程仓库"><a href="#客户端clone远程仓库" class="headerlink" title="客户端clone远程仓库"></a>客户端clone远程仓库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir localgit</span><br><span class="line">cd localgit</span><br><span class="line">git clone git@192.168.61.128:/data/git/gittest.git .</span><br><span class="line"><span class="meta">#</span> 提示输入服务端git账户的密码。</span><br><span class="line"><span class="meta">#</span>修改完就可以提交了</span><br><span class="line"></span><br><span class="line">touch abc.txt</span><br><span class="line">git add .</span><br><span class="line">git commit -m 'aaa'</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/git/">git</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/22/db/redis/redis文章发布/" title="redis文章发布" itemprop="url">redis文章发布</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-22T07:50:00.000Z" itemprop="datePublished"> Published 2019-02-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="定时任务发布方式"><a href="#定时任务发布方式" class="headerlink" title="定时任务发布方式"></a>定时任务发布方式</h2><ul>
<li>如果有后台发布文章，需要有定时任务将mysql中录入的文章同步到redis中</li>
<li><ol>
<li>这时候文章id当然是mysql自增产生的，生成一个文章id表示的文章内容 <figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	conn.hmset(<span class="string">"article:100:hash"</span>,&#123;属性字典&#125;）</span><br><span class="line">``` </span><br><span class="line">- <span class="number">2.</span> 作者发布的文章，文章的投票者集合当然有作者，需要设置投票集合。</span><br><span class="line">```py</span><br><span class="line">	conn.sadd(<span class="string">"artile:100:set"</span>,atrticle.uid)</span><br><span class="line">	conn.expire(<span class="string">"artile:100:set"</span>,<span class="number">7</span>*<span class="number">86400</span>) <span class="comment"># 一周有效期</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><ol start="3">
<li>文章的评分zset初始化,文章发布时间集合初始化。<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conn.zincrby(<span class="string">"article:100:score:zset"</span>,<span class="number">432</span>)， <span class="number">432</span> 是一个投票的评分。</span><br><span class="line">conn.zadd(<span class="string">"article:time:zset"</span>,article_id, now)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h2 id="如果是没有mysql，完全用redis这时候，文章id就需要一个string类型的key自增产生，其余步骤一致。"><a href="#如果是没有mysql，完全用redis这时候，文章id就需要一个string类型的key自增产生，其余步骤一致。" class="headerlink" title="如果是没有mysql，完全用redis这时候，文章id就需要一个string类型的key自增产生，其余步骤一致。"></a>如果是没有mysql，完全用redis这时候，文章id就需要一个string类型的key自增产生，其余步骤一致。</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/redis/">redis</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/22/db/redis/redis文章投票/" title="redis文章投票" itemprop="url">redis文章投票</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-22T07:50:00.000Z" itemprop="datePublished"> Published 2019-02-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="1-文章信息可以用hash表示"><a href="#1-文章信息可以用hash表示" class="headerlink" title="1. 文章信息可以用hash表示"></a>1. 文章信息可以用hash表示</h2><ul>
<li><p>比如文章id为key，文章属性为filed，属性值为value</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key : articel:<span class="number">1</span> </span><br><span class="line">title : 这是标题</span><br><span class="line">link： www.baidu.com</span><br><span class="line">updatetime: <span class="number">2019</span><span class="number">-02</span><span class="number">-21</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>也可以用大的hash，每个filed是一个文章id，value是一个json表示文章属性，</p>
</li>
</ul>
<h2 id="2-文章id和发布时间对应关系用zset表示"><a href="#2-文章id和发布时间对应关系用zset表示" class="headerlink" title="2. 文章id和发布时间对应关系用zset表示"></a>2. 文章id和发布时间对应关系用zset表示</h2><ul>
<li>文章id对应member，发布时间是score</li>
</ul>
<h2 id="3-文章id和文章评分对应关系也可用zset表示"><a href="#3-文章id和文章评分对应关系也可用zset表示" class="headerlink" title="3. 文章id和文章评分对应关系也可用zset表示"></a>3. 文章id和文章评分对应关系也可用zset表示</h2><ul>
<li>文章id对应member， 分数对应score</li>
</ul>
<h2 id="4-对一篇文章首次投票之后，发生什么变化？"><a href="#4-对一篇文章首次投票之后，发生什么变化？" class="headerlink" title="4. 对一篇文章首次投票之后，发生什么变化？"></a>4. 对一篇文章首次投票之后，发生什么变化？</h2><ul>
<li><ol start="0">
<li>有时只需要7天之内发布的文章才可以投票，否则直接返回。</li>
</ol>
</li>
<li><ol>
<li>用户是不支持重复投票的，所有应该有一个文章id对应的set类型的key，将投过票的uid加入到里面，如果加入失败，就说明重复了，就不增加评分。</li>
</ol>
</li>
<li><ol start="2">
<li>首先对应文章id的评分增加，具体增加规则： 将文章的已获得的支持票数*一个常量 +发布时间戳；常量可以432（86400/200）200个投票需求，平均一天时间。，这只是我见到的一个方法。</li>
</ol>
</li>
<li><ol start="3">
<li>增加文章的投票+1，使用hincrby ，前提是如果用hash记录文章属性的话，投票数就是一个属性。</li>
</ol>
</li>
<li><ol start="4">
<li>考虑到并发，如果以上三个操作应该用事物操作，保证原子性。</li>
</ol>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/redis/">redis</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/22/db/redis/redis文章分组的用途/" title="redis文章分组的用途" itemprop="url">redis文章分组的用途</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-22T07:50:00.000Z" itemprop="datePublished"> Published 2019-02-22</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="文章分组的用途"><a href="#文章分组的用途" class="headerlink" title="文章分组的用途"></a>文章分组的用途</h2><ul>
<li>文章分组，可以用set结构存储同一个分组的文章id</li>
<li>set可以和zset使用zinterstore命令求交集，set默认的score是1， zset默认的一般不是1，可以指定参数max，取score大的值。</li>
<li>比如获取一个分组A中的文章按时间排序，就拿这个分组和发布时间集合zset求交集，交集可以取一个临时名字，设置有效期60s。</li>
<li>比如获取一个分组B中的文章按照评分大小排序，就拿这个分组和评分集合zset求交集。</li>
<li>一般接口直接就拿redis获取的数据返回了。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/redis/">redis</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/21/linux/Vm虚拟机的三种联网模式区别/" title="VM虚拟机三种联网模式区别" itemprop="url">VM虚拟机三种联网模式区别</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-21T08:00:00.000Z" itemprop="datePublished"> Published 2019-02-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="1-HOST-ONLY"><a href="#1-HOST-ONLY" class="headerlink" title="1.HOST-ONLY"></a>1.HOST-ONLY</h2><p><img src="/2019/02/21/linux/Vm虚拟机的三种联网模式区别/images/vmnet.png" alt=""> </p>
<ul>
<li>对应图中的private to my Mac 选项</li>
<li>这种模式不能联网，能通过DHCP分配到ip地址，使用VMnet1网卡作为交换机，默认网关就是VMnet1的地址，能和主机通信，不能连接外网。</li>
<li>VMnet1网卡作为交换机，一个连接主机HOST，一个端口连接DHCP服务器（一个VM组件），剩下的链接虚拟机，没有提供NAT服务，所以没有路由功能。</li>
</ul>
<h2 id="2-NAT模式，网络地址转换"><a href="#2-NAT模式，网络地址转换" class="headerlink" title="2.NAT模式，网络地址转换"></a>2.NAT模式，网络地址转换</h2><ul>
<li><p>对应图中的 share with my Mac 选项 ，这是共享网络模式</p>
</li>
<li><p>这种模式，使用DHCP分配ip地址，使用VMnet8作为交换机，能与主机通信，能连接外网。</p>
</li>
<li><p>VMnet8网卡作为交换机，一个连接主机HOST，一个端口连接DHCP服务器（一个VM组件），一个端口连接NAT服务器（也是一个VM组件）。剩下端口的链接虚拟机。</p>
</li>
<li><p>以上模式，主要是NAT服务器的区别，导致一个能链接外网一个不能。</p>
</li>
</ul>
<h2 id="3-Bridged模式，（桥接模式）"><a href="#3-Bridged模式，（桥接模式）" class="headerlink" title="3.Bridged模式，（桥接模式）"></a>3.Bridged模式，（桥接模式）</h2><ul>
<li>就是图片中的Bridged NetWorking部分，可以看到有自动模式，WIFI模式，蓝牙模式，因为mac可以用多种方式联网。</li>
<li>这种模式对VMnet0，它相当于一个网桥，连接主机和虚拟机，这样虚拟机和你的主机就是两个对等的设备了，当然也是可以联网。</li>
</ul>
<h2 id="虚拟机vmnet0、vmnet1和vmnet8的区别"><a href="#虚拟机vmnet0、vmnet1和vmnet8的区别" class="headerlink" title="虚拟机vmnet0、vmnet1和vmnet8的区别"></a><a href="https://www.cnblogs.com/feifei-cyj/p/7686166.html" target="_blank" rel="noopener">虚拟机vmnet0、vmnet1和vmnet8的区别</a></h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/16/linux/nginx连接数和内核参数关系/" title="nginx连接数和内核参数的联系" itemprop="url">nginx连接数和内核参数的联系</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-16T04:06:00.000Z" itemprop="datePublished"> Published 2019-02-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>没明白呢。。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/15/linux/tcp半连接队列和全连接队列/" title="tcp连接过程，半连接队列和全连接队列" itemprop="url">tcp连接过程，半连接队列和全连接队列</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-15T04:06:00.000Z" itemprop="datePublished"> Published 2019-02-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tcp三次握手的过程"><a href="#tcp三次握手的过程" class="headerlink" title="tcp三次握手的过程"></a>tcp三次握手的过程</h2><ul>
<li>第一次：客户端发送SYN(Synchronize Sequence Numbers)报文，标志位SYN=1,序列号seq=j。</li>
<li>第二次：服务端收到SYN报文后，回应ACK(Acknowledgement)，标志位ACK=1,确认号ack为j+1， 同时自己也发送一个SYN报文，SYN=1,序列号seq假设为k， 即一个ACK+SYN包</li>
<li>第三次：客户端收到报文后，发送一个ACK报文，标志位ACK=1，确认号ack=(k+1) 到服务器，客户端和服务器进入ESTABLISHED状态，TCP链接成功。</li>
<li>SYN是同步报文标志位，建立连接时为1，连接建立后置为0，ACK时确认标志位一般为1</li>
</ul>
<h2 id="tcp四次挥手过程，为什么是4次呢？"><a href="#tcp四次挥手过程，为什么是4次呢？" class="headerlink" title="tcp四次挥手过程，为什么是4次呢？"></a>tcp四次挥手过程，为什么是4次呢？</h2><ul>
<li>假如客户端主动发起关闭操作</li>
<li>第一次： 客户端发送FIN报文，假设为序列号seq=i给服务器。</li>
<li>第二次： 服务发送ACK报文，ack=(i+1)给客户端，可能数据还没有接收完毕，所以服务端socket状态由ESTABLISHED -&gt; CLOSE_WAIT状态。</li>
<li>第三次： 服务端端处理完毕，发送FIN报文，序列号为j。</li>
<li>第四次： 客户端收到报文后，发送ACK报文，ack=j+1, 并进入TIME_WAIT状态。等待2MSL后自动关闭</li>
</ul>
<blockquote>
<ul>
<li>为什么客户端不发完ack就释放呢，因为服务器可能没收到ack，服务器会重新发送FIN请求关闭连接，客户端重新发送ack，所以一个来回就是2<br>个报文周期。当连接处于2MSL等待阶段时任何迟到的报文段都将被丢弃。</li>
</ul>
</blockquote>
<p>借用一张图表示一下<br><img src="https://img-blog.csdnimg.cn/20190214095421560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pXRTc2MTYxNzU=,size_16,color_FFFFFF,t_70" alt="aa"></p>
<h2 id="如果已经建立了连接，但是客户端突然出现故障了怎么办？"><a href="#如果已经建立了连接，但是客户端突然出现故障了怎么办？" class="headerlink" title="如果已经建立了连接，但是客户端突然出现故障了怎么办？"></a>如果已经建立了连接，但是客户端突然出现故障了怎么办？</h2><blockquote>
<p>TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75分钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。</p>
</blockquote>
<h2 id="查看网络链接的命令"><a href="#查看网络链接的命令" class="headerlink" title="查看网络链接的命令"></a>查看网络链接的命令</h2><ul>
<li>查看不同状态的链接数<blockquote>
<ul>
<li>netstat -an | awk ‘/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}’</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="半连接状态队列sync-queue和全连接队列accept-queue"><a href="#半连接状态队列sync-queue和全连接队列accept-queue" class="headerlink" title="半连接状态队列sync_queue和全连接队列accept_queue"></a>半连接状态队列sync_queue和全连接队列accept_queue</h2><ul>
<li>第一种实现：<blockquote>
<ul>
<li>BSD实现和在linux2.2之前，listen系统调用backlog参数表示半链接+全链接队列数之和</li>
<li>当队列满了以后，服务端再收到SYN时，将不会返回SYN/ACK。比较优雅的处理方法就是不处理这条连接，不返回RST，让客户端重试.</li>
<li>accept系统调用只是简单地从完成队列中取出连接.</li>
</ul>
<ul>
<li>第二种实现：</li>
</ul>
<ul>
<li>linux内核2.2以上的版本，SYN_RCVD队列的大小由proc/sys/net/ipv4/tcp_max_syn_backlog系统参数指定，ESTABLISHED队列由backlog和/proc/sys/net/core/somaxconn中较小的指定</li>
</ul>
</blockquote>
</li>
</ul>
<ul>
<li><img src="http://img2.cnxct.com/2015/06/tcp-sync-queue-and-accept-queue-small.jpg" alt=""></li>
</ul>
<ul>
<li>如果全连接队列满了怎么办？</li>
</ul>
<blockquote>
<ul>
<li>服务器不予处理，这样客户端会任务数据丢失，重新发送ack确认，如果服务器有空间，会重新加入到ESTABLISHED队列。</li>
</ul>
</blockquote>
<ul>
<li>如果client端没收到服务器发来的FIN，那么client会一直是FIN_WAIT_2吗？</li>
</ul>
<blockquote>
<ul>
<li>设置系统变量</li>
<li>sysctl -w net.ipv4.tcp_fin_timeout=5  </li>
<li>直接ctrl+c杀死客户端，发现FIN_WAIT_2的状态的链接，一会就消失了，并不会进入TIMEWAIT状态。</li>
</ul>
</blockquote>
<ul>
<li>怎么查看链接状态呢？</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -natp | grep 8888</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>8888是服务端监听的端口，因为tcp链接总是有一端是8888端口的。</span><br></pre></td></tr></table></figure>
<ul>
<li><p>查看每个ip和服务器的连接数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat|awk '&#123;print$5&#125;'|awk -F : '&#123;print$1&#125;'|sort|uniq -c|sort -rn</span><br></pre></td></tr></table></figure>
</li>
<li><p>什么是MSL呢？</p>
</li>
</ul>
<blockquote>
<ul>
<li>linux上的定义，就是60s<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TCP_TIMEWAIT_LEN (60*HZ) <span class="comment">/* how long to wait to destroy TIME-WAIT</span></span></span><br><span class="line"><span class="meta"><span class="comment">                  * state, about 60 seconds */</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li>全连接队列满了怎么办呢？<blockquote>
<ul>
<li>服务器根据 /proc/sys/net/ipv4/tcp_abort_on_overflow的值处理</li>
<li>0 表示丢弃ack，让客户端重新发ack</li>
<li>1 表示表示发送一个RST给客户端，直接废弃掉这个握手过程，客户端会出现connection reset by peer的错误</li>
</ul>
</blockquote>
</li>
</ul>
<ul>
<li><a href="https://tools.ietf.org/html/rfc793" target="_blank" rel="noopener">tcp协议RFC文档</a></li>
<li><a href="https://blog.csdn.net/yangbodong22011/article/details/60399728" target="_blank" rel="noopener">参考链接1</a></li>
<li><a href="https://blog.csdn.net/hhhanpan/article/details/79388945" target="_blank" rel="noopener">参考链接2</a></li>
<li><a href="https://blog.csdn.net/dog250/article/details/81256550" target="_blank" rel="noopener">参考链接3</a></li>
<li><a href="https://blog.csdn.net/jhcsdb/article/details/34921167" target="_blank" rel="noopener">socket耗尽，半连接队列限制</a></li>
<li><a href="https://www.cnblogs.com/jessezeng/p/5617105.html" target="_blank" rel="noopener">参考链接4</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/14/linux/ip地址子网掩码的关系/" title="ip地址和子网掩码，广播地址关系" itemprop="url">ip地址和子网掩码，广播地址关系</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-14T06:00:00.000Z" itemprop="datePublished"> Published 2019-02-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="什么是ip地址？"><a href="#什么是ip地址？" class="headerlink" title="什么是ip地址？"></a>什么是ip地址？</h2><ul>
<li>ip是在一个网段中的一台计算机的ip地址（192.168.1.2）</li>
<li>如果你家的联通宽带给你家的公网ip地址是10.10.123.234(假设的)，那么接到你家路由器，首先路由器需要有一个ip地址，一般是192.168.1.1（也可能是192.168.0.1），这个应该可以登录到路由器中设置。</li>
<li>其中192.168.1.255 就是广播地址，比如centos中ifconfig命令查看的broadcast</li>
<li>剩余的ip段192.168.1.2~192.168.1.254 就是可以分配给手机，电脑等客户端使用的ip。一共是253（255-2）个。</li>
</ul>
<h2 id="ip由什么组成？"><a href="#ip由什么组成？" class="headerlink" title="ip由什么组成？"></a>ip由什么组成？</h2><ul>
<li>例如一个ip 192.168.1.2，是一个C类网络，一般有254台主机。二进制表示就是 网络号标识|1100 0000 |1000 0000| 0000 0001|  + 主机号标识|0000 0010| </li>
<li>点号分割每个数字都是8位二进制,网络号部分就是192.168.1,主机号部分就是2。</li>
<li>网络标识部分越短，那么标识主机部分可用的范围越大，但是需要子网掩码配合决定由多少可用ip</li>
</ul>
<h2 id="什么是子网掩码？"><a href="#什么是子网掩码？" class="headerlink" title="什么是子网掩码？"></a>什么是子网掩码？</h2><ul>
<li>子网掩码，顾名思义，遮掩的意思，子网掩码就是把ip地址分为网络部分和主机部分，主机部分用二进制位用1标识，主机号部分用0标识。C类子网掩码一般是255.255.255.0 </li>
<li>如果所需的ip比较多，比如学校这种环境，子网掩码可以设置成255.255.0.0 ,那么ip返回就是255的2次方-2，就是65023个。那么ip网络部分就是192.168,后面两部分是主机号。</li>
</ul>
<ul>
<li>网关是什么，比如两个A客户端192.168.1.2 和B客户端192.168.2.2 就是两个网络的设备，前提是他们的子网掩码都是255.255.255.0， 那么他们通信就需要A客户端发送给网关ip，有网关路由转发到B所在的网关，再转发到B客户端。 比如我的路由器ip是192.168.2.1， 我自己的ip是192.168.2.110， 默认网关也是192.168.2.1</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat -rn</span><br><span class="line"></span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">0.0.0.0         192.168.2.1     0.0.0.0         UG        0 0          0 ens33</span><br><span class="line">0.0.0.0表示发给任何人的包，都发给192.168.2.1这个网关， Genmask写0.0.0.0是默认路由的网络掩码。</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/14/language/python/2__init__文件的作用/" title="python 导入模块文件以及相对导入和__init__文件作用" itemprop="url">python 导入模块文件以及相对导入和__init__文件作用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-14T06:00:00.000Z" itemprop="datePublished"> Published 2019-02-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="python-导入模块文件的2中方式"><a href="#python-导入模块文件的2中方式" class="headerlink" title="python 导入模块文件的2中方式"></a>python 导入模块文件的2中方式</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lib <span class="keyword">or</span> <span class="keyword">from</span> lib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入子目录中模块</span></span><br><span class="line"><span class="keyword">import</span> tmp.lib3  <span class="keyword">or</span>  <span class="keyword">from</span> tmp.lib3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入上级目录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'home/app/'</span>)</span><br><span class="line"><span class="keyword">import</span> mod</span><br><span class="line"><span class="keyword">import</span> xxxx</span><br></pre></td></tr></table></figure>
<ul>
<li><p>与import类似, 被导入的module仍然会执行且仅执行一次</p>
</li>
<li><p>from *** import 的实质</p>
</li>
<li><p>当以 “from *** import “ 方式导入module时, python会在当前module 的命名空间中新建相应的命名. 即, “from t2 import var1” 相当于:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> t2</span><br><span class="line">var1= t2.var1</span><br></pre></td></tr></table></figure>
</li>
<li><p>from package import item  # 这种方式，item可以是包中的一个子模块或子包，也可以是包中定义的其他命名，像函数、类、变量。</p>
</li>
<li>import item.subitem.subsubitem # 这些子项必须是包，最后的子项是包或模块。但不能为函数、类或变量。否则出错：No module named ***</li>
</ul>
<h2 id="init-py-的作用"><a href="#init-py-的作用" class="headerlink" title="__init__.py 的作用"></a>__init__.py 的作用</h2><p>python import package都是根据每个module的<strong>name</strong>来实现的。<br>比如说，有一个文件夹结构为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package/</span><br><span class="line">    __init__.py</span><br><span class="line">    subpackage1/</span><br><span class="line">        __init__.py</span><br><span class="line">        moduleX.py</span><br><span class="line">    moduleA.py</span><br></pre></td></tr></table></figure>
<ul>
<li><p>那么，如果（在这个package文件夹之外，比如package的同级文件夹下建立运行一个run.py）运行一个script，来导入moduleX模块，那么这个moduleX的<strong>name</strong>就是.package.subpackage1.moduleX，由于moduleX获得了前述名称，那么在moduleX.py内部就可以有relative import的语句，比如说：from .. import moduleA</p>
</li>
<li><p>而moduleX之所以能够获得的.package.subpackage1.moduleX的<strong>name</strong> attribute属性，前提是package被python解释器识别成了一个package来处理（比如在package的同级文件夹下的运行的run.py有import package.subpackage1.moduleX之类的语句）。可是，如果每一个被我直接run的python script都会被视作是top-level script。top-level script的<strong>name</strong>被自动设置成<strong>main</strong>。因此，如果我从package文件夹内部直接运行moduleA.py这个脚本，那么它的<strong>name</strong>就被置成了<strong>main</strong>，python也不会把它当作一个package，其中的relative import的语句自然就无法起作用了。</p>
</li>
</ul>
<h2 id="总之，运行脚本要在包目录的外层，包里面的模块之间才能用-或则-等相对路径做导入操作。换句话，就是存在from-import-xxx-的文件不能直接python-xxx-py操作，即使存在init-py-也不会被认为是一个包。"><a href="#总之，运行脚本要在包目录的外层，包里面的模块之间才能用-或则-等相对路径做导入操作。换句话，就是存在from-import-xxx-的文件不能直接python-xxx-py操作，即使存在init-py-也不会被认为是一个包。" class="headerlink" title="总之，运行脚本要在包目录的外层，包里面的模块之间才能用. 或则 ..等相对路径做导入操作。换句话，就是存在from .. import xxx 的文件不能直接python xxx.py操作，即使存在init.py, .也不会被认为是一个包。"></a>总之，运行脚本要在包目录的外层，包里面的模块之间才能用. 或则 ..等相对路径做导入操作。换句话，就是存在from .. import xxx 的文件不能直接python xxx.py操作，即使存在<strong>init</strong>.py, .也不会被认为是一个包。</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/python/">python</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/14/language/python/1_三种装饰器/" title="python类的三种装饰器" itemprop="url">python类的三种装饰器</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-14T06:00:00.000Z" itemprop="datePublished"> Published 2019-02-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="property装饰器作用和原理"><a href="#property装饰器作用和原理" class="headerlink" title="property装饰器作用和原理"></a>property装饰器作用和原理</h2><ul>
<li><ol>
<li>我们知道c++中有public,projected,private等修饰类私有属性的作用，这样就限定了某些属性只能读取，不能修改；有些能读也能需改。</li>
</ol>
</li>
<li><ol start="2">
<li>设置C++类中的一个属性可以自定义方法get和set方法。</li>
</ol>
</li>
<li><ol start="3">
<li>python中实现这种原理，就需要装饰器property，本身可修饰（变量x同名）的函数，让x拥有可读的属性（相当于get函数</li>
</ol>
</li>
<li><ol start="4">
<li>@property进而又生成一个@x.setter装饰器，在修饰一下属性x同名的函数就让x拥有可写的属性（相当于set函数）</li>
</ol>
</li>
</ul>
<h2 id="property-装饰器"><a href="#property-装饰器" class="headerlink" title="property 装饰器"></a>property 装饰器</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._birth</span><br><span class="line"></span><br><span class="line"><span class="meta">    @birth.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._birth = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2014</span> - self._birth</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># birth 是一个可读可写的属性，age是只读属性。</span></span><br><span class="line">    <span class="comment"># property装饰器本身可以把getter方法变成属性，同时生成一个@birth.setter装饰器，可以修饰birth变成一个可设置的属性。</span></span><br><span class="line">    <span class="comment"># 但要注意这些额外函数的名字和 property 下的一样，例如这里的 birth,age。</span></span><br></pre></td></tr></table></figure>
<h2 id="一种古老的用法，使用内置函数property实现如下，和上面的方法一样。"><a href="#一种古老的用法，使用内置函数property实现如下，和上面的方法一样。" class="headerlink" title="一种古老的用法，使用内置函数property实现如下，和上面的方法一样。"></a>一种古老的用法，使用内置函数property实现如下，和上面的方法一样。</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self._name = name</span><br><span class="line">        self._age = age</span><br><span class="line">        self._color = <span class="string">'Black'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(value, basestring):</span><br><span class="line">            self._name = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._name = <span class="string">'No name'</span></span><br><span class="line"></span><br><span class="line">    name = property(fget=get_name, fset=set_name, fdel=<span class="keyword">None</span>, doc=<span class="string">'name of an animal'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_age</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span> <span class="keyword">and</span> value &lt; <span class="number">100</span>:</span><br><span class="line">            self._age = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._age = <span class="number">0</span></span><br><span class="line">            <span class="comment"># print 'invalid age value.'</span></span><br><span class="line"></span><br><span class="line">    age = property(fget=get_age, fset=set_age, fdel=<span class="keyword">None</span>, doc=<span class="string">'name of an animal'</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">a = Animal(<span class="string">'black dog'</span>, <span class="number">3</span>)</span><br><span class="line">a.name = <span class="string">'white dog'</span></span><br><span class="line">a.age = <span class="number">3</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Name:'</span>, a.name</span><br><span class="line"><span class="keyword">print</span> Animal.name.__doc__</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Age:'</span>, a.age</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/python/">python</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/13/language/python/9_大型程序结构/" title="flask 第9章（大型程序目录结构）" itemprop="url">flask 第9章（大型程序目录结构）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-13T13:18:00.000Z" itemprop="datePublished"> Published 2019-02-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="1-创建目录结构"><a href="#1-创建目录结构" class="headerlink" title="1. 创建目录结构"></a>1. 创建目录结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mkdir myflask &amp; cd myflask</span><br><span class="line"></span><br><span class="line">touch reuirments.txt</span><br><span class="line">touch config.py # 配置</span><br><span class="line">touch manger.py </span><br><span class="line"></span><br><span class="line">mkdir app # 一个应用一个app这样的目录</span><br><span class="line">touch app/__init__.py # 说明这是一个包</span><br><span class="line">touch app/emails.py</span><br><span class="line">touch app/models.py</span><br><span class="line"></span><br><span class="line">mkdir app/templates</span><br><span class="line">mkdir app/static</span><br><span class="line">mkdir app/main</span><br><span class="line"></span><br><span class="line">touch app/main/__init__.py  #为了保存蓝本，整一个子包</span><br><span class="line">touch app/main/errors.py</span><br><span class="line">touch app/main/forms.py</span><br><span class="line">touch app/main/views.py</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 迁移目录</span><br><span class="line">mkdir migrations</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 单元测试目录</span><br><span class="line">mkdir test</span><br><span class="line">touch test/__init__.py</span><br><span class="line">touch test/test.py</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> venv  这个目录是虚拟环境目录，命令自动创建</span><br></pre></td></tr></table></figure>
<h2 id="2-代码下载"><a href="#2-代码下载" class="headerlink" title="2. 代码下载"></a>2. 代码下载</h2><ul>
<li>代码太多就不站粘贴了,下面是下载地址，前面是每个章节是一个详细流程，这个结构中上下文这块还不是很懂，继续学习…<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/wedvefv/my_flask_learn.git</span><br></pre></td></tr></table></figure>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/flask/">flask</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/13/language/python/8_邮件模块/" title="flask 第8章（邮件模块）" itemprop="url">flask 第8章（邮件模块）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-13T03:57:00.000Z" itemprop="datePublished"> Published 2019-02-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-mail</span><br></pre></td></tr></table></figure>
<h2 id="smtp配置"><a href="#smtp配置" class="headerlink" title="smtp配置"></a>smtp配置</h2><ul>
<li>smtp 简单邮件传输协议,如果不配置，默认使用localhost主机，25端口，无需验证即可发送邮件</li>
<li>如果配置，这使用配置的服务器发送mail</li>
</ul>
<h2 id="smtp-配置选项"><a href="#smtp-配置选项" class="headerlink" title="smtp 配置选项"></a>smtp 配置选项</h2><table>
<thead>
<tr>
<th>配置</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>MAIL_SERVER</td>
<td>localhost</td>
<td>电子邮件服务器的主机名或ip地址</td>
</tr>
<tr>
<td>MAIL_PORT</td>
<td>25</td>
<td>电子邮件服务器的端口</td>
</tr>
<tr>
<td>MAIL_USE_TLS</td>
<td>False</td>
<td>启用传输层安全</td>
</tr>
<tr>
<td>MAIL_USE_SSL</td>
<td>False</td>
<td>启用安全套接层</td>
</tr>
<tr>
<td>MAIL_USERNAME</td>
<td>None</td>
<td>邮件账户名</td>
</tr>
<tr>
<td>MAIL_PASSWORD</td>
<td>None</td>
<td>邮件账户密码</td>
</tr>
</tbody>
</table>
<h2 id="整个hello-py文件"><a href="#整个hello-py文件" class="headerlink" title="整个hello.py文件"></a>整个hello.py文件</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf=8</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MySQLdb,os</span><br><span class="line"><span class="comment"># 引入核心模块和模板加载模块</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template,session,redirect,url_for,flash</span><br><span class="line"><span class="comment"># 引入bootstrap前端框架</span></span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="comment"># 引入时间模块,实现了momment.js</span></span><br><span class="line"><span class="keyword">from</span> flask_moment <span class="keyword">import</span> Moment</span><br><span class="line"><span class="comment"># 引入manage模块，服务器启动参数控制</span></span><br><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"><span class="comment"># 引入表单模块</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="comment"># 引入表单字段类</span></span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField,SubmitField</span><br><span class="line"><span class="comment"># 引入表单验证函数</span></span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Required</span><br><span class="line"><span class="comment"># 导入数据库包</span></span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="comment"># 导入数据迁移模块</span></span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate,MigrateCommand</span><br><span class="line"><span class="comment"># 导入mail 模块</span></span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail,Message</span><br><span class="line"><span class="comment"># 每个web表单都有一个继承自FlaskForm的类表示,所以先定义一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    name = StringField(<span class="string">"what is your name ?"</span>,validators=[Required()]) <span class="comment"># 字段对象可附加多个验证函数，所以是列表, Required确保非空</span></span><br><span class="line">    submit = SubmitField(<span class="string">"Submit1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 生成加密令牌的密钥,再用令牌验证请求的表单数据真伪</span></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'this random string！'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line">app.config[<span class="string">"SQLALCHEMY_DATABASE_URI"</span>] = <span class="string">"mysql://appwriter:appwr@zxcv@127.0.0.1/flask1?charset=utf8"</span></span><br><span class="line">app.config[<span class="string">"SQLALCHEMY_COMMIT_ON_TEARDOWN"</span>] = <span class="keyword">True</span> <span class="comment"># 请求结束自动提交数据库变动</span></span><br><span class="line">app.config[<span class="string">"SQLALCHEMY_TRACK_MODIFICATIONS"</span>] = <span class="keyword">True</span> <span class="comment"># 这行不能缺</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MAIL 配置</span></span><br><span class="line">app.config[<span class="string">"MAIL_SERVER"</span>] = <span class="string">'smtp.qq.com'</span> <span class="comment">## qq邮箱smtp服务器</span></span><br><span class="line">app.config[<span class="string">'MAIL_PORT'</span>]= <span class="number">25</span></span><br><span class="line">app.config[<span class="string">'MAIL_USE_TLS'</span>] = <span class="keyword">False</span></span><br><span class="line">app.config[<span class="string">'MAIL_USERNAME'</span>] = os.environ.get(<span class="string">'MAIL_USERNAME'</span>) <span class="comment">#qq邮箱</span></span><br><span class="line">app.config[<span class="string">'MAIL_PASSWORD'</span>] = os.environ.get(<span class="string">'MAIL_PASSWORD'</span>) <span class="comment">#qq邮箱客户端登录授权码，相当于密码</span></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'FLASK_MAIL_SUBJECT_PREFIX'</span>] = <span class="string">'[Flasky]'</span></span><br><span class="line">app.config[<span class="string">'FLASK_MAIL_SENDER'</span>] = <span class="string">'FLASK Admin&lt;%s&gt;'</span> % os.environ.get(<span class="string">'MAIL_USERNAME'</span>) <span class="comment">#发送者</span></span><br><span class="line">app.config[<span class="string">'FLASK_ADMIN'</span>] = os.environ.get(<span class="string">"FLASK_ADMIN"</span>)</span><br><span class="line"><span class="keyword">print</span> app.config[<span class="string">'FLASK_ADMIN'</span>]</span><br><span class="line"><span class="comment">#SQLALCHEMY_COMMIT_TEARDOWN = True</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app) <span class="comment"># 数据库实例 模型继承于db.model, 模型在python就是一个类，数据库中是一个表，类属性就是表字段</span></span><br><span class="line"></span><br><span class="line">bootstrap = Bootstrap(app)</span><br><span class="line">moment = Moment(app)</span><br><span class="line">manager = Manager(app)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line">manager.add_command(<span class="string">'db'</span>,  MigrateCommand)</span><br><span class="line">mail = Mail(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'roles'</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">64</span>),unique=<span class="keyword">True</span>)</span><br><span class="line">    users = db.relationship(<span class="string">"User"</span>, backref=<span class="string">'role'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;Role %r&gt; '</span> % self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"users"</span></span><br><span class="line">    id = db.Column(db.Integer,primary_key=<span class="keyword">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">64</span>),unique=<span class="keyword">True</span>)</span><br><span class="line">    role_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'roles.id'</span>))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;User %r&gt; '</span> % self.username</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(e)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'404.html'</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(500)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">internal_server_error</span><span class="params">(e)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'500.html'</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/1', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index1</span><span class="params">()</span>:</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        old_name = session.get(<span class="string">"name"</span>)</span><br><span class="line">        <span class="keyword">if</span> old_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> old_name != form.name.data:</span><br><span class="line">            flash(<span class="string">"your are changing your name ."</span>)</span><br><span class="line">        session[<span class="string">"name"</span>] = form.name.data</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"index"</span>)) <span class="comment"># 一般endpoint就是视图函数名</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, form=form, name = session.get(<span class="string">'name'</span>))</span><br><span class="line">    <span class="comment">#return render_template("index.html", form=form, name = None)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/", methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    form = NameForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        user = User.query.filter_by(username=form.name.data).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            user = User(username=form.name.data)</span><br><span class="line">            db.session.add(user)</span><br><span class="line">            session[<span class="string">'known'</span>] = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">'known'</span>] = <span class="keyword">True</span></span><br><span class="line">        session[<span class="string">'name'</span>] = form.name.data</span><br><span class="line">        form.name.data = <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"index"</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>, form = form, name = session.get(<span class="string">"name"</span>), known=session.get(<span class="string">'known'</span>,<span class="keyword">False</span>) )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_email</span><span class="params">(to, subject, template, **kwargs)</span>:</span></span><br><span class="line">	msg = Message(app.config[<span class="string">'FLASK_MAIL_SUBJECT_PREFIX'</span>] + subject,</span><br><span class="line">	sender=app.config[<span class="string">'FLASK_MAIL_SENDER'</span>], recipients=[to])      </span><br><span class="line">	<span class="comment">#msg.body = render_template(template + '.txt', **kwargs)</span></span><br><span class="line">	msg.html = render_template(template + <span class="string">'.html'</span>,**kwargs)</span><br><span class="line">	mail.send(msg)</span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route("/mail", methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index2</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="number">90</span></span><br><span class="line">	form = NameForm()</span><br><span class="line">	<span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">		user = User.query.filter_by(username=form.name.data).first() <span class="comment"># 如果数据库没有这个name，说明是新用户，就给管理员发封邮件。</span></span><br><span class="line">		<span class="comment">#print "2222", user</span></span><br><span class="line">		<span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">			user = User(username=form.name.data)</span><br><span class="line">			db.session.add(user)</span><br><span class="line">			session[<span class="string">'known'</span>] = <span class="keyword">False</span></span><br><span class="line">			<span class="keyword">if</span> app.config[<span class="string">'FLASK_ADMIN'</span>]:</span><br><span class="line">				<span class="comment">#print "123",app.config['FLASK_ADMIN']</span></span><br><span class="line">				send_email(app.config[<span class="string">'FLASK_ADMIN'</span>], <span class="string">'New User'</span>, <span class="string">'mail/new_user'</span>,user=user)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			session[<span class="string">'known'</span>] = <span class="keyword">True</span></span><br><span class="line">		session[<span class="string">'name'</span>] = form.name.data</span><br><span class="line">		form.name.data = <span class="string">''</span></span><br><span class="line">		<span class="keyword">return</span> redirect(url_for(<span class="string">'index2'</span>))</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,form=form,name=session.get(<span class="string">'name'</span>),known=session.get(<span class="string">'known'</span>,<span class="keyword">False</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>
<h2 id="邮件模板"><a href="#邮件模板" class="headerlink" title="邮件模板"></a>邮件模板</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir template/mail</span><br><span class="line">touch template/mail/new_user.html</span><br><span class="line">写入邮件模板,用户提交用户名时，向ADMIN发送一封邮件。</span><br><span class="line">User &#123;&#123; user.username &#125;&#125; has joined.</span><br></pre></td></tr></table></figure>
<h2 id="需要配置的环境变量"><a href="#需要配置的环境变量" class="headerlink" title="需要配置的环境变量"></a>需要配置的环境变量</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">export MAIL_USERNAME=<span class="string">''</span> <span class="comment"># 比如qq邮箱账号</span></span><br><span class="line">export MAIL_PASSWORD=<span class="string">''</span> <span class="comment"># 如果是qq邮箱，这里是qq邮箱的客户端授权码，需要短信验证生成</span></span><br><span class="line">export FLASK_ADMIN=<span class="string">''</span> <span class="comment"># 这封邮件的接受者</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/flask/">flask</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/13/language/python/7_数据迁移/" title="flask 第7章（数据迁移模块）" itemprop="url">flask 第7章（数据迁移模块）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wedvefv" target="_blank" itemprop="author">wedvefv</a>
		
  <p class="article-time">
    <time datetime="2019-02-13T03:41:00.000Z" itemprop="datePublished"> Published 2019-02-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask-migrate</span><br></pre></td></tr></table></figure>
<h2 id="配置模块"><a href="#配置模块" class="headerlink" title="配置模块"></a>配置模块</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入模块类</span></span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate,MigrateCommand</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">migrate = Migrate(app,db)</span><br><span class="line">manger.add_command(<span class="string">'db'</span>, MigrateCommand)</span><br></pre></td></tr></table></figure>
<h2 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h2><h3 id="1-初始化迁移仓库"><a href="#1-初始化迁移仓库" class="headerlink" title="1. 初始化迁移仓库"></a>1. 初始化迁移仓库</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python hello.py db init</span><br><span class="line"><span class="comment"># 会创建migrations 文件夹</span></span><br></pre></td></tr></table></figure>
<h3 id="2-创建迁移脚本模板"><a href="#2-创建迁移脚本模板" class="headerlink" title="2. 创建迁移脚本模板"></a>2. 创建迁移脚本模板</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python hello.py db migrate -m <span class="string">"migrate initial"</span></span><br><span class="line"><span class="comment"># version文件夹会生成一个py文件里面有2个函数，升级数据库函数upgrade，降级数据库函数downgrade，需要用户自己重写所需操作</span></span><br></pre></td></tr></table></figure>
<h3 id="3-升级更新数据库"><a href="#3-升级更新数据库" class="headerlink" title="3. 升级更新数据库"></a>3. 升级更新数据库</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python hello.py db upgrade </span><br><span class="line"><span class="comment"># 执行该命令会自动执行version目录下的py脚本中的upgrade函数，前提是数据库alembic_version表中没有该版本的升级记录。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于第一个迁移，和db.create_all()方法一样，后续版本升级，upgrade命令会把改动应用到数据库中。</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/flask/">flask</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="https://github.com/wedvefv" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/atom/" title="atom">atom<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/c/" title="c">c<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/flask/" title="flask">flask<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/git/" title="git">git<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/html/" title="html">html<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx/" title="nginx">nginx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/redis/" title="redis">redis<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/vim/" title="vim">vim<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/windows/" title="windows">windows<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/加密算法/" title="加密算法">加密算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/微信支付/" title="微信支付">微信支付<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/git/" title="git">git<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/hexo/" title="hexo">hexo<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/vim/" title="vim">vim<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/encrypt/" title="encrypt">encrypt<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/c/" title="c++">c++<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/windows/" title="windows">windows<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ajax/" title="ajax">ajax<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/html5/" title="html5">html5<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="https://ejs.bootcss.com/" target="_blank" title="ejs教程">ejs教程</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m xiaoying Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/5803571716" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/https://github.com/wedvefv" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/10970080" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="wedvefv">wedvefv</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', '', '');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
